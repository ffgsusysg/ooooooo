<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <title> اديسون</title>
    
    <link rel="manifest" href="manifest.json">
    <link rel="icon" href="https://cdn.glitch.global/c07dc79d-c056-48b0-8b0b-912783754321/5424770778815132543.jpg?v=1751739020203">
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700;900&display=swap" rel="stylesheet" />
    <link rel="stylesheet" href="https://cdn.plyr.io/3.7.8/plyr.css" />
    <script src="https://unpkg.com/lucide@latest"></script>
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
    <script src="https://cdn.plyr.io/3.7.8/plyr.js"></script>

    <style>
        :root {
            --primary-hue: 210;
            --accent-hue: 45;
            --primary-color: hsl(var(--primary-hue), 89%, 60%);
            --primary-dark: hsl(var(--primary-hue), 89%, 50%);
            --accent-color: hsl(var(--accent-hue), 95%, 55%);
            --accent-dark: hsl(var(--accent-hue), 95%, 50%);
            
            --bg-light: #f8fafc;
            --bg-dark: #0b1120;
            --card-light: #ffffff;
            --card-dark: #172033;
            --text-light: #0f172a;
            --text-dark: #e2e8f0;
            --border-light: #e2e8f0;
            --border-dark: #334155;

            --bg: var(--bg-light);
            --card-bg: var(--card-light);
            --text-color: var(--text-light);
            --border-color: var(--border-light);
            --shadow-color: 220 3% 15%;
            --shadow-strength: 1%;
            --shadow-sm: 0 1px 2px 0 hsl(var(--shadow-color) / calc(var(--shadow-strength) + 9%));
            --shadow-md: 0 3px 5px 0 hsl(var(--shadow-color) / calc(var(--shadow-strength) + 7%)),
                         0 1px 2px -1px hsl(var(--shadow-color) / calc(var(--shadow-strength) + 8%));
            --shadow-lg: 0 10px 15px -3px hsl(var(--shadow-color) / calc(var(--shadow-strength) + 7%)),
                         0 4px 6px -4px hsl(var(--shadow-color) / calc(var(--shadow-strength) + 8%));
            --radius: 12px;
            --radius-lg: 16px;
        }

        [data-theme="dark"] {
            --bg: var(--bg-dark);
            --card-bg: var(--card-dark);
            --text-color: var(--text-dark);
            --border-color: var(--border-dark);
            --shadow-color: 220 40% 2%;
            --shadow-strength: 25%;
        }

        *, *::before, *::after {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: "Cairo", sans-serif;
            background-color: var(--bg);
            color: var(--text-color);
            transition: background-color 0.3s, color 0.3s;
        }
        
        /* --- Header & Navigation --- */
        header {
            position: sticky;
            top: 0;
            z-index: 1000;
            background-color: color-mix(in srgb, var(--bg) 80%, transparent);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border-bottom: 1px solid var(--border-color);
            padding: 1rem 1.5rem;
            transition: background-color 0.3s, border-color 0.3s;
        }

        .nav-container {
            display: flex;
            justify-content: space-between;
            align-items: center;
            max-width: 1300px;
            margin: 0 auto;
        }

        .site-title {
            font-size: 1.75rem;
            font-weight: 900;
            color: var(--primary-color);
            display: flex;
            align-items: center;
            gap: 0.75rem;
            cursor: pointer;
            text-decoration: none;
        }

        .site-logo {
            width: 40px;
            height: 40px;
            background: var(--primary-color);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            box-shadow: var(--shadow-sm);
        }

        .header-actions {
            display: flex;
            align-items: center;
            gap: 1rem;
        }
        
        .desktop-nav {
            display: none;
        }

        .hamburger-menu {
            display: flex;
            flex-direction: column;
            gap: 5px;
            cursor: pointer;
            padding: 0.5rem;
            z-index: 1001; /* Ensure hamburger is above menu */
        }

        .hamburger-menu .bar {
            width: 25px;
            height: 3px;
            background-color: var(--text-color);
            border-radius: 3px;
            transition: all 0.3s ease-in-out;
        }
        
        .hamburger-menu.active .bar:nth-child(1) { transform: translateY(8px) rotate(45deg); }
        .hamburger-menu.active .bar:nth-child(2) { opacity: 0; }
        .hamburger-menu.active .bar:nth-child(3) { transform: translateY(-8px) rotate(-45deg); }

        .mobile-menu {
            position: fixed;
            top: 0;
            right: 0;
            width: 300px;
            height: 100%;
            background-color: var(--bg);
            transform: translateX(100%);
            transition: transform 0.4s cubic-bezier(0.23, 1, 0.32, 1);
            padding: 6rem 2rem 2rem 2rem;
            display: flex;
            flex-direction: column;
            gap: 1.5rem;
            z-index: 999;
            box-shadow: -5px 0 25px hsl(var(--shadow-color) / calc(var(--shadow-strength) + 10%));
        }
        
        .mobile-menu.active { transform: translateX(0); }

        .mobile-menu .menu-item {
            display: flex;
            align-items: center;
            gap: 1rem;
            font-size: 1.2rem;
            font-weight: 700;
            color: var(--text-color);
            text-decoration: none;
            padding: 1rem;
            border-radius: var(--radius);
            transition: background-color 0.2s;
            background: none;
            border: none;
            width: 100%;
            text-align: right;
            cursor: pointer;
        }
        
        .mobile-menu .menu-item:hover { background-color: color-mix(in srgb, var(--primary-color) 10%, transparent); }

        /* --- Page Layout --- */
        .page { display: none; padding: 1.5rem; max-width: 1300px; margin: 0 auto; }
        .page.active { display: block; }

        .section-title {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            font-size: 1.5rem;
            font-weight: 900;
            margin-bottom: 2rem;
            padding-bottom: 0.75rem;
            border-bottom: 3px solid var(--primary-color);
            color: var(--text-color);
        }
        
        /* --- New Category Cards --- */
        .categories-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 2rem;
        }

        .category-card {
            position: relative;
            border-radius: var(--radius-lg);
            overflow: hidden;
            box-shadow: var(--shadow-md);
            cursor: pointer;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            background: var(--card-bg);
            border: 1px solid var(--border-color);
        }

        .category-card:hover {
            transform: translateY(-8px);
            box-shadow: var(--shadow-lg);
        }

        .card-header {
            padding: 2rem;
            position: relative;
            overflow: hidden;
            border-bottom: 1px solid var(--border-color);
        }

        .card-header::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, var(--glow-color) 0%, transparent 70%);
            opacity: 0.2;
            transition: opacity 0.4s ease;
        }
        
        [data-theme="dark"] .card-header::before { opacity: 0.1; }

        .category-card:hover .card-header::before { opacity: 0.4; }
        [data-theme="dark"] .category-card:hover .card-header::before { opacity: 0.2; }


        .card-icon {
            width: 50px;
            height: 50px;
            color: var(--icon-color);
            margin-bottom: 1rem;
        }

        .card-title {
            font-size: 1.75rem;
            font-weight: 900;
            color: var(--text-color);
        }

        .card-content {
            padding: 1.5rem 2rem 2rem 2rem;
        }

        .card-description {
            color: color-mix(in srgb, var(--text-color) 70%, transparent);
            margin-bottom: 2rem;
            min-height: 50px;
            line-height: 1.7;
        }

        .card-button {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.75rem 1.5rem;
            border-radius: var(--radius);
            background-color: var(--icon-color);
            color: #fff;
            font-weight: bold;
            transition: all 0.3s ease;
        }

        .category-card:hover .card-button {
            transform: scale(1.05);
            box-shadow: 0 4px 15px color-mix(in srgb, var(--icon-color) 40%, transparent);
        }

        #card-2026 { --icon-color: #3b82f6; --glow-color: hsl(217, 91%, 60%, 0.5); }
        #card-2025 { --icon-color: #f97316; --glow-color: hsl(24, 95%, 53%, 0.5); }
        #card-distinguished { --icon-color: #10b981; --glow-color: hsl(158, 82%, 41%, 0.5); }
        #card-literary { --icon-color: #8b5cf6; --glow-color: hsl(262, 89%, 67%, 0.5); }

        /* --- Professional Teacher Cards (Modified) --- */
        .teachers-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 2rem;
        }

        .teacher-card {
            background: var(--card-bg);
            border-radius: var(--radius-lg);
            border: 1px solid var(--border-color);
            overflow: hidden;
            transition: transform 0.3s ease, box-shadow 0.3s ease, border-color 0.3s ease;
            box-shadow: var(--shadow-md);
            cursor: pointer;
            display: flex;
            flex-direction: column;
        }

        .teacher-card:hover {
            transform: translateY(-8px);
            box-shadow: var(--shadow-lg);
            border-color: var(--primary-color);
        }
        
        .teacher-card-content {
            padding: 2rem 1.5rem 1.5rem 1.5rem;
            text-align: center;
            position: relative;
            flex-grow: 1;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
        }

        .teacher-avatar {
            width: 100px;
            height: 100px;
            border-radius: 50%;
            object-fit: cover;
            margin: 0 auto 1rem auto;
            border: 4px solid var(--card-bg);
            background-color: var(--card-bg);
            box-shadow: var(--shadow-md);
        }

        .teacher-name {
            font-size: 1.3rem;
            font-weight: 700;
            margin-bottom: 0.25rem;
            color: var(--text-color);
            transition: color 0.3s ease;
        }
        
        .teacher-card:hover .teacher-name { color: var(--primary-color); }

        .teacher-subject {
            font-size: 0.95rem;
            color: color-mix(in srgb, var(--text-color) 70%, transparent);
            margin-bottom: 1rem;
            font-weight: 500;
        }
        
        .teacher-rating {
            display: flex;
            justify-content: center;
            gap: 0.3rem;
            margin-bottom: 1.5rem;
        }

        .teacher-rating .star {
            color: color-mix(in srgb, var(--text-color) 20%, transparent);
            font-size: 1.2rem;
        }

        .teacher-rating .star.filled { color: var(--accent-color); }
        
        .teacher-cta {
            margin-top: auto;
            font-weight: 600;
            color: var(--primary-dark);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            transition: color 0.3s ease, letter-spacing 0.3s ease;
        }
        
        .teacher-card:hover .teacher-cta {
            color: var(--accent-dark);
            letter-spacing: 0.5px;
        }
        
        /* Other components */
        .btn {
            display: inline-flex;
            align-items: center;
            gap: 0.45rem;
            padding: 0.75rem 1.25rem;
            border-radius: var(--radius);
            background: var(--primary-color);
            color: #fff;
            font-weight: 700;
            border: none;
            cursor: pointer;
            transition: all 0.25s ease;
        }
        .btn:hover {
            background: var(--primary-dark);
            transform: translateY(-2px);
            box-shadow: var(--shadow-md);
        }
        .back-button { margin-bottom: 1.5rem; }
        .teacher-info { display: flex; align-items: center; gap: 1.4rem; background: var(--card-bg); padding: 1.6rem; border-radius: var(--radius); border: 1px solid var(--border-color); flex-wrap: wrap; margin-bottom: 1.5rem; box-shadow: var(--shadow-md); }
        .teacher-img-lg { width: 120px; height: 120px; border-radius: 50%; object-fit: cover; border: 4px solid var(--accent-color); box-shadow: var(--shadow-md); }
        .classes-list { display: grid; gap: 1.4rem; }
        .class-card { background: var(--card-bg); border-radius: var(--radius); border: 1px solid var(--border-color); overflow: hidden; box-shadow: var(--shadow-sm); }
        .class-header { display: flex; justify-content: space-between; align-items: center; padding: 1.1rem 1.3rem; cursor: pointer; user-select: none; border-right: 4px solid var(--primary-color); }
        .class-header:hover { background: color-mix(in srgb, var(--primary-color) 5%, transparent); }
        .class-header span { transition: transform 0.25s ease; }
        .class-header.open span { transform: rotate(180deg); }
        .lectures-list { display: none; flex-direction: column; gap: 0.7rem; padding: 1.1rem 1.5rem 0.9rem 0; }
        .lecture-item { position: relative; padding: 0.9rem 1.1rem 0.9rem 3.5rem; background: color-mix(in srgb, var(--primary-color) 5%, transparent); border-right: 3px solid var(--primary-dark); border-radius: var(--radius); cursor: pointer; transition: all 0.25s ease; display: flex; justify-content: space-between; align-items: center; }
        .lecture-item:hover { background: color-mix(in srgb, var(--primary-color) 10%, transparent); }
        .lecture-item i { position: absolute; left: 12px; top: 50%; transform: translateY(-50%); color: var(--primary-color); }
        .video-page { display: flex; flex-direction: column; gap: 2rem; }
        .video-container { position: relative; width: 100%; background: #000; border-radius: var(--radius); overflow: hidden; aspect-ratio: 16/9; box-shadow: var(--shadow-lg); }
        .plyr { border-radius: var(--radius); overflow: hidden; width: 100%; height: 100%; }
        .video-details { background: var(--card-bg); padding: 1.5rem; border-radius: var(--radius); border: 1px solid var(--border-color); text-align: center; box-shadow: var(--shadow-md); }
        .video-info { text-align: right; padding: 1rem 0; }
        .video-meta { display: flex; justify-content: center; gap: 1.5rem; margin-top: 1rem; opacity: 0.8; font-size: 0.9rem; flex-wrap: wrap; }
        .video-meta span { display: flex; align-items: center; gap: 0.3rem; }
        .video-loader { position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0, 0, 0, 0.8); display: flex; justify-content: center; align-items: center; z-index: 10; border-radius: var(--radius); }
        .loader-spinner { border: 6px solid #f3f3f3; border-top: 6px solid var(--primary-color); border-radius: 50%; width: 60px; height: 60px; animation: spin 1s linear infinite; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        .modal { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0, 0, 0, 0.7); display: flex; justify-content: center; align-items: center; z-index: 2000; opacity: 0; visibility: hidden; transition: opacity 0.3s ease, visibility 0.3s ease; }
        .modal.show { opacity: 1; visibility: visible; }
        .modal-content { background: linear-gradient(135deg, hsl(265, 82%, 24%), hsl(217, 96%, 57%)); border-radius: var(--radius); padding: 2.5rem; box-shadow: var(--shadow-lg); max-width: 550px; width: 90%; text-align: center; transform: translateY(-20px); transition: transform 0.3s ease; border: 1px solid rgba(255, 255, 255, 0.2); }
        .modal.show .modal-content { transform: translateY(0); }
        .modal-header { margin-bottom: 1.5rem; border-bottom: 2px solid var(--accent-color); padding-bottom: 1rem; }
        .modal-title { font-size: 2rem; color: #fff; display: flex; align-items: center; justify-content: center; gap: 0.75rem; font-weight: 700; }
        .modal-body p { font-size: 1.2rem; color: #fff; margin-bottom: 2.5rem; line-height: 1.8; font-weight: 500; }
        .btn-telegram { background: linear-gradient(45deg, #00c6ff, #0072ff); color: #fff; padding: 1.2rem 2.5rem; font-size: 1.2rem; margin-bottom: 1.2rem; width: fit-content; margin-left: auto; margin-right: auto; border-radius: var(--radius); box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3); transition: all 0.3s ease; }
        .btn-telegram:hover { transform: translateY(-5px) scale(1.02); box-shadow: 0 8px 20px rgba(0, 0, 0, 0.4); }
        .btn-outline-telegram { background: transparent; border: 2px solid #fff; color: #fff; padding: 0.9rem 1.8rem; font-size: 1rem; transition: all 0.25s ease; width: fit-content; margin-left: auto; margin-right: auto; border-radius: var(--radius); }
        .btn-outline-telegram:hover { background: rgba(255, 255, 255, 0.1); transform: translateY(-2px); }
        #continueWatchingModal .modal-content { background: linear-gradient(135deg, #4facfe, #00f2fe); max-width: 450px; padding: 2rem; }
        #continueWatchingModal .modal-title { font-size: 1.6rem; margin-bottom: 1rem; color: #fff; }
        #continueWatchingModal .modal-body p { font-size: 1rem; color: #fff; margin-bottom: 0.5rem; line-height: 1.4; }
        #continueWatchingModal .modal-body p .highlight-text { color: var(--highlight-color); font-weight: bold; text-shadow: var(--highlight-shadow); }
        .btn-continue-now { background-color: #00c896; color: #fff; padding: 1rem 2rem; font-size: 1.1rem; margin-top: 1.5rem; margin-left: auto; margin-right: auto; border-radius: var(--radius); box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3); transition: all 0.3s ease; display: inline-flex; align-items: center; gap: 0.5rem; }
        .btn-continue-now:hover { background-color: #00a87a; transform: translateY(-3px) scale(1.01); }

        /* Responsive adjustments */
        @media (min-width: 768px) {
            .hamburger-menu { display: none; }
            .desktop-nav { display: flex; align-items: center; gap: 0.5rem; }
            .page { padding: 2.5rem; }
        }
        @media (max-width: 480px) {
            .page { padding: 1rem; }
            .section-title { font-size: 1.25rem; }
            .card-title { font-size: 1.5rem; }
            .teacher-name { font-size: 1.15rem; }
        }
    </style>
</head>
<body>
    <header>
        <div class="nav-container">
            <a href="#" class="site-title" id="siteTitleLink">
                <div class="site-logo">إ</div>
                <span>منصة إديسون</span>
            </a>
            <nav class="header-actions">
                <div class="desktop-nav">
                    <button id="themeToggleDesktop" class="btn">
                        <i data-lucide="sun"></i><span>المظهر</span>
                    </button>
                    <button id="examsButtonDesktop" class="btn">
                        <i data-lucide="file-text"></i><span>امتحانات الأساتذة</span>
                    </button>
                    <a href="https://t.me/hmed882" target="_blank" class="btn">
                        <i data-lucide="send"></i><span>راسلنا</span>
                    </a>
                </div>
                <div class="hamburger-menu" id="hamburgerMenu">
                    <div class="bar"></div>
                    <div class="bar"></div>
                    <div class="bar"></div>
                </div>
            </nav>
        </div>
    </header>

    <div class="mobile-menu" id="mobileMenu">
        <button id="themeToggleMobile" class="menu-item">
            <i data-lucide="sun"></i><span>المظهر</span>
        </button>
        <button id="examsButtonMobile" class="menu-item">
            <i data-lucide="file-text"></i><span>امتحانات الأساتذة</span>
        </button>
        <a href="https://t.me/hmed882" target="_blank" class="menu-item">
            <i data-lucide="send"></i><span>راسلنا على التيلجرام</span>
        </a>
    </div>

    <!-- Main Content -->
    <main>
        <div id="homePage" class="page active">
            <div class="section-title">
                <i data-lucide="layout-grid"></i>
                <h3>اختر القسم المناسب لك</h3>
            </div>
            
            <div class="categories-grid">
                <div id="card-2026" class="category-card" data-category="year-2026">
                    <div class="card-header">
                        <div class="card-pattern"></div>
                        <i class="card-icon" data-lucide="calendar-days"></i>
                        <h3 class="card-title">مدرسين سنة 2026</h3>
                    </div>
                    <div class="card-content">
                        <p class="card-description">المحاضرات والمواد الدراسية لطلاب 2026</p>
                        <div class="card-button">
                            <span>عرض المواد</span>
                            <i data-lucide="arrow-left"></i>
                        </div>
                    </div>
                </div>
                
                <div id="card-2025" class="category-card" data-category="year-2025">
                    <div class="card-header">
                        <div class="card-pattern"></div>
                        <i class="card-icon" data-lucide="calendar-check-2"></i>
                        <h3 class="card-title">مدرسين سنة 2025</h3>
                    </div>
                    <div class="card-content">
                        <p class="card-description">المحاضرات والمواد الدراسية لطلاب 2025</p>
                        <div class="card-button">
                            <span>عرض المواد</span>
                            <i data-lucide="arrow-left"></i>
                        </div>
                    </div>
                </div>
                
                <div id="card-distinguished" class="category-card" data-category="distinguished">
                    <div class="card-header">
                        <div class="card-pattern"></div>
                         <i class="card-icon" data-lucide="star"></i>
                        <h3 class="card-title">قسم المتميزين</h3>
                    </div>
                    <div class="card-content">
                        <p class="card-description">مواد خاصة للطلاب المتميزين</p>
                        <div class="card-button">
                            <span>عرض المواد</span>
                            <i data-lucide="arrow-left"></i>
                        </div>
                    </div>
                </div>
                
                <div id="card-literary" class="category-card" data-category="literary">
                    <div class="card-header">
                        <div class="card-pattern"></div>
                        <i class="card-icon" data-lucide="book-marked"></i>
                        <h3 class="card-title">القسم الأدبي</h3>
                    </div>
                    <div class="card-content">
                        <p class="card-description">المواد والمناهج للفرع الادبي</p>
                        <div class="card-button">
                            <span>عرض المواد</span>
                            <i data-lucide="arrow-left"></i>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div id="categoryPage" class="page">
            <button class="btn back-button" id="backToHomeBtn">
                <i data-lucide="arrow-right"></i><span>الرجوع للأقسام</span>
            </button>
            <div class="section-title">
                <i data-lucide="users"></i>
                <h3 id="categoryTitle"></h3>
            </div>
            <div id="teachersGrid" class="teachers-grid"></div>
        </div>

        <div id="classesPage" class="page">
            <button class="btn back-button" id="backToCategoryBtn">
                <i data-lucide="arrow-right"></i><span>الرجوع للمدرسين</span>
            </button>
            <div class="teacher-info">
                <img id="teacherImage" class="teacher-img-lg" alt="" />
                <div>
                    <h2 id="teacherName" style="font-size: 2rem; font-weight: 900;"></h2>
                    <p id="teacherSubject" style="font-size: 1.1rem;"></p>
                    <div id="teacherRating" class="teacher-rating"></div>
                </div>
            </div>
            <div class="section-title">
                <i data-lucide="book-open"></i>
                <h3>الفصول الدراسية</h3>
            </div>
            <div id="classesList" class="classes-list"></div>
        </div>

        <div id="videoPage" class="page">
            <div class="video-page">
                <div id="videoContainer" class="video-container">
                    <div id="playerContainer"></div>
                    <div id="videoLoader" class="video-loader" style="display: none;">
                        <div class="loader-spinner"></div>
                    </div>
                </div>
                <div class="video-details">
                    <h2 id="videoTitle"></h2>
                    <p id="videoDescription"></p>
                    <div class="video-info">
                        <div class="video-meta">
                            <span><i data-lucide="calendar"></i> تاريخ النشر: <span id="videoDate">--/--/----</span></span>
                        </div>
                    </div>
                    <button class="btn back-button" id="backToClassesBtn">
                        <i data-lucide="arrow-right"></i><span>العودة للفصول</span>
                    </button>
                </div>
            </div>
        </div>
    </main>

    <!-- Modals -->
    <div id="telegramModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title"><i data-lucide="bell"></i>مرحبًا في منصة إديسون!</h3>
            </div>
            <div class="modal-body">
                <p>لا تنسى تشترك في قناتنا على تيلجرام حتى توصلك أحدث التحديثات والأخبار الجديدة.</p>
                <a href="https://t.me/od7cc" target="_blank" class="btn btn-telegram"><i data-lucide="send"></i><span>اشترك الآن</span></a>
                <button id="continueWithoutSubscribingBtn" class="btn btn-outline-telegram">اشتركت سابقا المتابعة</button>
            </div>
        </div>
    </div>
    <div id="continueWatchingModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title"><i data-lucide="graduation-cap"></i>عزيزي الطالب</h3>
            </div>
            <div class="modal-body">
                <p>لقد كنت تشاهد الأستاذ <span id="lastWatchedTeacherName" class="highlight-text"></span></p>
                <p>في المحاضرة: <span id="lastWatchedLectureTitle" class="highlight-text"></span></p>
                <p>لاتنسى تكمل محاضراتك وبس حبيت اذكرك ❤️</p>
                <button id="continueNowBtn" class="btn btn-continue-now"><i data-lucide="play"></i><span>متابعة</span></button>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // --- App State & Elements ---
            const DOM = {
                themeToggles: document.querySelectorAll('#themeToggleDesktop, #themeToggleMobile'),
                hamburgerMenu: document.getElementById('hamburgerMenu'),
                mobileMenu: document.getElementById('mobileMenu'),
                siteTitleLink: document.getElementById('siteTitleLink'),
                pages: {
                    home: document.getElementById('homePage'),
                    category: document.getElementById('categoryPage'),
                    classes: document.getElementById('classesPage'),
                    video: document.getElementById('videoPage')
                },
                categoryCards: document.querySelectorAll('.category-card'),
                backToHomeBtn: document.getElementById('backToHomeBtn'),
                backToCategoryBtn: document.getElementById('backToCategoryBtn'),
                backToClassesBtn: document.getElementById('backToClassesBtn'),
                categoryTitle: document.getElementById('categoryTitle'),
                teachersGrid: document.getElementById('teachersGrid'),
                teacherInfo: {
                    image: document.getElementById('teacherImage'),
                    name: document.getElementById('teacherName'),
                    subject: document.getElementById('teacherSubject'),
                    rating: document.getElementById('teacherRating')
                },
                classesList: document.getElementById('classesList'),
                video: {
                    title: document.getElementById('videoTitle'),
                    description: document.getElementById('videoDescription'),
                    container: document.getElementById('playerContainer')
                },
                modals: {
                    telegram: document.getElementById('telegramModal'),
                    continueWatching: document.getElementById('continueWatchingModal')
                },
                continueWithoutSubscribingBtn: document.getElementById('continueWithoutSubscribingBtn'),
                continueNowBtn: document.getElementById('continueNowBtn'),
                lastWatchedTeacherName: document.getElementById('lastWatchedTeacherName'),
                lastWatchedLectureTitle: document.getElementById('lastWatchedLectureTitle'),
            };

            let state = {
                player: null,
                hlsInstance: null,
                progressInterval: null,
                teachers: [],
                currentTeacher: null,
                lectureProgress: JSON.parse(localStorage.getItem("lectureProgress")) || {},
                ratings: JSON.parse(localStorage.getItem("ratings")) || {},
                lastWatched: JSON.parse(localStorage.getItem("lastWatched")) || null
            };

            const categories = {
                "year-2026": { title: "الصفوف الدراسية 2026", endpoint: "https://adson.netlify.app/data2.json" },
                "year-2025": { title: "الصفوف الدراسية 2025", endpoint: "https://adson.netlify.app/data.json" },
                "distinguished": { title: "قسم المتميزين", endpoint: "https://adson.netlify.app/ff.json" },
                "literary": { title: "القسم الأدبي", endpoint: "https://adson.netlify.app/mm.json" }
            };

            // --- Core Functions ---
            const applyTheme = (theme) => {
                document.documentElement.setAttribute('data-theme', theme);
                localStorage.setItem('theme', theme);
                const icon = theme === 'dark' ? 'sun' : 'moon';
                DOM.themeToggles.forEach(toggle => {
                    const i = toggle.querySelector('i');
                    if (i) i.setAttribute('data-lucide', icon);
                });
                lucide.createIcons();
            };

            const navigate = (page) => {
                window.scrollTo({ top: 0, behavior: 'smooth' });
                if (page !== 'video' && state.player) {
                    state.player.destroy();
                    state.player = null;
                    if (state.hlsInstance) { state.hlsInstance.destroy(); state.hlsInstance = null; }
                    if (state.progressInterval) clearInterval(state.progressInterval);
                    DOM.video.container.innerHTML = "";
                }
                Object.values(DOM.pages).forEach(p => p.classList.remove('active'));
                DOM.pages[page].classList.add('active');
                DOM.hamburgerMenu.classList.remove('active');
                DOM.mobileMenu.classList.remove('active');
            };

            const renderStars = (rating) => Array.from({ length: 5 }, (_, i) => `<span class="star ${i < rating ? 'filled' : ''}">★</span>`).join('');

            const renderTeachers = (list = state.teachers) => {
                if (!list.length) {
                    DOM.teachersGrid.innerHTML = `<p>لا توجد نتائج مطابقة.</p>`;
                    return;
                }
                DOM.teachersGrid.innerHTML = list.map(t => `
                    <div class="teacher-card" data-teacher-id="${t.id}">
                        <div class="teacher-card-content">
                            <img class="teacher-avatar" src="${t.image}" alt="${t.name}" onerror="this.onerror=null;this.src='https://placehold.co/100x100/E2E8F0/A0AEC0?text=No+Img';">
                            <div>
                                <h3 class="teacher-name">${t.name}</h3>
                                <p class="teacher-subject">${t.subject}</p>
                                <div class="teacher-rating">${renderStars(state.ratings[t.id] || 0)}</div>
                            </div>
                            <div class="teacher-cta"><span>عرض المحاضرات</span><i data-lucide="arrow-left"></i></div>
                        </div>
                    </div>`).join('');
                lucide.createIcons();
                DOM.teachersGrid.querySelectorAll('.teacher-card').forEach(card => {
                    card.addEventListener('click', () => showTeacher(card.dataset.teacherId));
                });
            };

            const showTeacher = (id) => {
                state.currentTeacher = state.teachers.find(t => t.id == id);
                if (!state.currentTeacher) return;
                const { image, name, subject, classes, id: teacherId } = state.currentTeacher;
                DOM.teacherInfo.image.src = image;
                DOM.teacherInfo.name.textContent = name;
                DOM.teacherInfo.subject.textContent = subject;
                DOM.teacherInfo.rating.innerHTML = renderStars(state.ratings[teacherId] || 0);
                renderClasses(classes);
                navigate('classes');
            };
            
            const renderClasses = (classesData) => {
                DOM.classesList.innerHTML = classesData.map((cls, ci) => `
                    <div class="class-card">
                        <div class="class-header"><h3>${cls.name}</h3><span data-lucide="chevron-down"></span></div>
                        <div class="lectures-list">
                            ${cls.lectures.map((lec, li) => `
                                <div class="lecture-item" data-ci="${ci}" data-li="${li}" data-url="${lec.url}" data-title="${lec.title}" data-desc="${lec.description || ''}">
                                    <i data-lucide="play-circle"></i><span>${li + 1}. ${lec.title}</span>
                                </div>`).join('')}
                        </div>
                    </div>`).join('');
                lucide.createIcons();
                DOM.classesList.querySelectorAll('.class-header').forEach(h => h.addEventListener('click', () => toggleLectures(h)));
                DOM.classesList.querySelectorAll('.lecture-item').forEach(item => {
                    item.addEventListener('click', () => {
                        const { ci, li, url, title, desc } = item.dataset;
                        playLecture(parseInt(ci), parseInt(li), url, title, desc);
                    });
                });
            };

            const toggleLectures = (header) => {
                const list = header.nextElementSibling;
                const icon = header.querySelector('[data-lucide]');
                const isOpen = list.style.display === 'flex';
                list.style.display = isOpen ? 'none' : 'flex';
                icon.setAttribute('data-lucide', isOpen ? 'chevron-down' : 'chevron-up');
                lucide.createIcons();
            };
            
            const loadData = (endpoint) => {
                DOM.teachersGrid.innerHTML = `<p>جاري تحميل المدرسين...</p>`;
                fetch(endpoint, { headers: { "Cache-Control": "no-cache" } })
                    .then(r => r.ok ? r.json() : Promise.reject('Failed to fetch'))
                    .then(data => { state.teachers = data.teachers; renderTeachers(); })
                    .catch(() => { DOM.teachersGrid.innerHTML = `<p>حدث خطأ في تحميل البيانات.</p>`; });
            };

            const playLecture = (ci, li, url, title, desc) => {
                if (state.player) state.player.destroy();
                DOM.video.title.textContent = title;
                DOM.video.description.textContent = desc || "لا يوجد وصف لهذه المحاضرة.";
                
                state.lastWatched = {
                    teacherId: state.currentTeacher.id, teacherName: state.currentTeacher.name,
                    classIndex: ci, lectureIndex: li, lectureTitle: title,
                    lectureUrl: url, lectureDescription: desc
                };
                localStorage.setItem("lastWatched", JSON.stringify(state.lastWatched));

                DOM.video.container.innerHTML = `<video id="player" playsinline controls></video>`;
                const videoElement = document.getElementById('player');
                
                state.player = new Plyr(videoElement, { controls: ['play-large', 'play', 'progress', 'current-time', 'mute', 'volume', 'fullscreen'] });

                if (url.endsWith('.m3u8')) {
                    if (Hls.isSupported()) {
                        state.hlsInstance = new Hls();
                        state.hlsInstance.loadSource(url);
                        state.hlsInstance.attachMedia(videoElement);
                    } else if (videoElement.canPlayType('application/vnd.apple.mpegurl')) {
                        videoElement.src = url;
                    }
                } else {
                    state.player.source = { type: 'video', sources: [{ src: url }] };
                }

                state.player.on('ready', () => {
                    const savedProgress = state.lectureProgress[url];
                    if (savedProgress && state.player.duration) {
                        state.player.currentTime = (savedProgress / 100) * state.player.duration;
                    }
                    state.player.play().catch(e => console.error("Video play failed:", e));
                });
                
                if(state.progressInterval) clearInterval(state.progressInterval);
                state.progressInterval = setInterval(() => {
                    if (state.player && state.player.duration > 0) {
                        state.lectureProgress[url] = (state.player.currentTime / state.player.duration) * 100;
                        localStorage.setItem("lectureProgress", JSON.stringify(state.lectureProgress));
                    }
                }, 5000);

                navigate('video');
            };

            const showContinueWatchingModal = () => {
                if (state.lastWatched) {
                    DOM.lastWatchedTeacherName.textContent = state.lastWatched.teacherName;
                    DOM.lastWatchedLectureTitle.textContent = state.lastWatched.lectureTitle;
                    DOM.modals.continueWatching.classList.add('show');
                }
            };

            const showTelegramModal = () => {
                if (!localStorage.getItem('telegramSubscribed')) {
                    DOM.modals.telegram.classList.add('show');
                } else {
                    showContinueWatchingModal();
                }
            };
            
            // --- Event Listeners Setup ---
            const initEventListeners = () => {
                DOM.themeToggles.forEach(toggle => toggle.addEventListener('click', toggleTheme));
                DOM.hamburgerMenu.addEventListener('click', () => {
                    DOM.hamburgerMenu.classList.toggle('active');
                    DOM.mobileMenu.classList.toggle('active');
                });
                DOM.siteTitleLink.addEventListener('click', (e) => { e.preventDefault(); navigate('home'); });
                DOM.categoryCards.forEach(card => {
                    card.addEventListener('click', () => {
                        const categoryId = card.dataset.category;
                        const category = categories[categoryId];
                        if (!category) return;
                        DOM.categoryTitle.textContent = category.title;
                        loadData(category.endpoint);
                        navigate('category');
                    });
                });
                DOM.backToHomeBtn.addEventListener('click', () => navigate('home'));
                DOM.backToCategoryBtn.addEventListener('click', () => navigate('category'));
                DOM.backToClassesBtn.addEventListener('click', () => navigate('classes'));

                DOM.continueWithoutSubscribingBtn.addEventListener('click', () => {
                    localStorage.setItem('telegramSubscribed', 'true');
                    DOM.modals.telegram.classList.remove('show');
                    showContinueWatchingModal();
                });

                DOM.continueNowBtn.addEventListener('click', () => {
                    DOM.modals.continueWatching.classList.remove('show');
                    if (!state.lastWatched) return;
                    
                    const findAndPlay = (endpoint) => {
                        return fetch(endpoint).then(r => r.json()).then(data => {
                            const teacher = data.teachers.find(t => t.id === state.lastWatched.teacherId);
                            if (teacher) {
                                state.currentTeacher = teacher;
                                playLecture(state.lastWatched.classIndex, state.lastWatched.lectureIndex, state.lastWatched.lectureUrl, state.lastWatched.lectureTitle, state.lastWatched.lectureDescription);
                                return true;
                            }
                            return false;
                        });
                    };

                    findAndPlay(categories['year-2026'].endpoint)
                        .then(found => !found && findAndPlay(categories['year-2025'].endpoint))
                        .then(found => !found && findAndPlay(categories['distinguished'].endpoint))
                        .then(found => !found && findAndPlay(categories['literary'].endpoint))
                        .catch(err => console.error("Error finding last watched lecture:", err));
                });
            };

            // --- Initialisation ---
            const init = () => {
                const storedTheme = localStorage.getItem('theme');
                const preferredTheme = window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light';
                applyTheme(storedTheme || preferredTheme);
                initEventListeners();
                lucide.createIcons();
                setTimeout(showTelegramModal, 1000);
            };

            init();
        });
    </script>
</body>
</html>
