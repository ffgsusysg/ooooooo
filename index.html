<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>منصة إديسون</title>

  <!-- Meta -->
  <meta property="og:title" content="منصة إديسون التعليمية" />
  <meta property="og:description" content="محاضرات ومتابعة تقدّم بشكل بسيط وخفيف" />
  <meta property="og:type" content="website" />
  <meta property="og:locale" content="ar_AR" />

  <!-- Icon & fonts -->
  <link rel="icon" href="https://cdn.glitch.global/c07dc79d-c056-48b0-8b0b-912783754321/5424770778815132543.jpg?v=1751739020203">
  <link href="https://fonts.googleapis.com/css2?family=Almarai:wght@400;700;800&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;700&display=swap" rel="stylesheet">

  <!-- Player -->
  <link rel="stylesheet" href="https://cdn.plyr.io/3.7.8/plyr.css" />
  <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
  <script src="https://cdn.plyr.io/3.7.8/plyr.polyfilled.min.js"></script>

  <!-- Icons -->
  <script src="https://unpkg.com/lucide@latest"></script>

  <style>
    :root{
      --bg:#f7fafc;--bg2:#ffffff;--text:#0f172a;--muted:#64748b;--pri:#2563eb;--pri-2:#1d4ed8;--acc:#f59e0b;
      --border:#e2e8f0;--r:14px;--shadow:0 8px 20px rgba(0,0,0,.06)
    }
    [data-theme="dark"]{
      --bg:#0b1220;--bg2:#0f172a;--text:#e2e8f0;--muted:#94a3b8;--pri:#60a5fa;--pri-2:#3b82f6;--acc:#fbbf24;--border:#1f2a44
    }
    *{box-sizing:border-box}
    html,body{margin:0;padding:0;font-family:Almarai,Tajawal,sans-serif;background:var(--bg);color:var(--text);line-height:1.6}
    a{color:inherit;text-decoration:none}
    .wrap{max-width:1200px;margin:auto;padding:1rem}
    .hidden{display:none}

    /* Header */
    header{position:sticky;top:0;background:rgba(255,255,255,.7);backdrop-filter:saturate(140%) blur(10px);
      border-bottom:1px solid var(--border);z-index:10}
    [data-theme="dark"] header{background:rgba(15,23,42,.7)}
    .row{display:flex;gap:.75rem;align-items:center;flex-wrap:wrap;justify-content:space-between;padding:.8rem 1rem}
    .brand{display:flex;align-items:center;gap:.6rem;font-weight:800;color:var(--pri);cursor:pointer}
    .logo{width:40px;height:40px;border-radius:50%;display:grid;place-items:center;background:var(--pri);color:#fff;font-weight:800}
    .actions{display:flex;gap:.5rem;align-items:center;flex-wrap:wrap}
    .btn{display:inline-flex;gap:.45rem;align-items:center;justify-content:center;border:none;border-radius:var(--r);
      background:var(--pri);color:#fff;padding:.7rem 1rem;font-weight:700;cursor:pointer;box-shadow:var(--shadow)}
    .btn:hover{background:var(--pri-2)}
    .btn-outline{background:transparent;color:var(--pri);border:2px solid var(--pri)}
    .btn-icon{width:44px;height:44px;border-radius:50%;padding:0;display:grid;place-items:center;background:var(--bg2);border:1px solid var(--border);color:var(--pri)}
    .search{display:flex;gap:.5rem;align-items:center;flex:1;min-width:240px;max-width:560px}
    .search input{flex:1;border:1px solid var(--border);background:var(--bg2);color:var(--text);border-radius:var(--r);padding:.75rem .9rem}

    /* Bot button (cute) */
    .bot{display:inline-flex;align-items:center;gap:.6rem;background:#229ED9;color:#fff;padding:.7rem 1rem;border-radius:999px;
      box-shadow:var(--shadow);font-weight:800}
    .bot i{width:18px;height:18px}
    .bot:hover{filter:brightness(1.05)}

    /* Pages */
    .page{display:none;padding:1rem}
    .page.active{display:block}
    .grid{display:grid;gap:1rem;grid-template-columns:repeat(auto-fit,minmax(230px,1fr))}
    .card{background:var(--bg2);border:1px solid var(--border);border-radius:var(--r);padding:1rem;box-shadow:var(--shadow)}
    .cat{cursor:pointer;position:relative}
    .cat h3{margin:.25rem 0 0;font-size:1.15rem}
    .muted{color:var(--muted);font-size:.95rem}
    .title{display:flex;align-items:center;gap:.6rem;margin:1rem 0 .8rem;color:var(--pri);font-weight:800}
    .teacher-card{text-align:center;cursor:pointer}
    .t-img{width:110px;height:110px;border-radius:50%;object-fit:cover;border:3px solid var(--acc);display:block;margin:.2rem auto .6rem}
    .row-s{display:flex;gap:.5rem;align-items:center;justify-content:space-between}
    .fav{width:36px;height:36px;border-radius:50%;border:1px solid var(--border);background:var(--bg2);display:grid;place-items:center;cursor:pointer}
    .fav.active{background:#ff5252;color:#fff;border-color:#ff5252}

    .list{display:grid;gap:.7rem}
    .item{background:var(--bg2);border:1px solid var(--border);border-right:4px solid var(--pri);border-radius:10px;padding:.8rem;display:flex;align-items:center;justify-content:space-between}
    .play{display:flex;gap:.6rem;align-items:center;cursor:pointer}
    .video-wrap{max-width:980px;margin:auto}
    .video{aspect-ratio:16/9;background:#000;border-radius:var(--r);overflow:hidden}
    .meta{display:flex;gap:1rem;flex-wrap:wrap;justify-content:center;margin:.6rem 0;color:var(--muted)}

    /* Toast */
    .toast{position:fixed;bottom:14px;right:14px;left:14px;max-width:420px;margin-inline:auto;background:var(--bg2);border:1px solid var(--border);
      border-radius:var(--r);padding:.8rem;display:none;gap:.6rem;align-items:center;box-shadow:var(--shadow)}
    .toast.show{display:flex}

    /* Simple helpers */
    .center{text-align:center}
    .mb1{margin-bottom:1rem}
    .mb2{margin-bottom:2rem}
  </style>
</head>
<body>
  <header>
    <div class="row wrap">
      <div class="brand" onclick="go('home')">
        <div class="logo">إ</div>
        <span>منصة إديسون</span>
      </div>

      <div class="actions" style="flex:1;justify-content:center">
        <div class="search">
          <input id="q" placeholder="ابحث عن مدرس…" />
          <button class="btn" id="searchBtn"><i data-lucide="search"></i><span>بحث</span></button>
        </div>
      </div>

      <div class="actions">
        <!-- Cute Telegram bot button -->
        <a class="bot" href="https://t.me/edson1bot" target="_blank" rel="noopener">
          <i data-lucide="send"></i><span>بوت الامتحانات</span>
        </a>
        <button id="dashBtn" class="btn-icon" title="لوحة التحكم"><i data-lucide="user"></i></button>
        <button id="themeBtn" class="btn-icon" title="الوضع الليلي/النهاري"><i data-lucide="moon"></i></button>
      </div>
    </div>
  </header>

  <main class="wrap">
    <!-- Home -->
    <section id="home" class="page active">
      <div class="title"><i data-lucide="layout-grid"></i><h3>اختر القسم</h3></div>
      <div class="grid" id="cats">
        <div class="card cat" onclick="loadCat('year-2026')">
          <i data-lucide="calendar-days"></i>
          <h3>مدرسين سنة 2026</h3>
          <div class="muted">محاضرات ومواد 2026</div>
        </div>
        <div class="card cat" onclick="loadCat('year-2025')">
          <i data-lucide="calendar-days"></i>
          <h3>مدرسين سنة 2025</h3>
          <div class="muted">محاضرات ومواد 2025</div>
        </div>
        <div class="card cat" onclick="loadCat('distinguished')">
          <i data-lucide="sparkles"></i>
          <h3>قسم المتميزين</h3>
          <div class="muted">مواد خاصة للمتفوقين</div>
        </div>
        <div class="card cat" onclick="loadCat('literary')">
          <i data-lucide="scroll-text"></i>
          <h3>القسم الأدبي</h3>
          <div class="muted">مواد ومناهج الأدبي</div>
        </div>
      </div>
    </section>

    <!-- Category / teachers -->
    <section id="category" class="page">
      <div class="row-s mb1">
        <button class="btn btn-outline" onclick="go('home')"><i data-lucide="arrow-right"></i> رجوع</button>
        <h3 id="catTitle" class="muted" style="margin:0"></h3>
      </div>

      <div id="favWrap" class="hidden">
        <div class="title"><i data-lucide="heart"></i><h3>المفضلون</h3></div>
        <div id="favGrid" class="grid"></div>
      </div>

      <div class="title"><i data-lucide="users"></i><h3>المدرسون</h3></div>
      <div id="tGrid" class="grid"></div>
    </section>

    <!-- Classes -->
    <section id="classes" class="page">
      <div class="row-s mb1">
        <button class="btn btn-outline" onclick="go('category')"><i data-lucide="arrow-right"></i> المدرسون</button>
        <div class="muted" id="tHead"></div>
      </div>
      <div id="clsList" class="list"></div>
    </section>

    <!-- Video -->
    <section id="video" class="page">
      <div class="video-wrap">
        <div class="video"><video id="player" playsinline controls></video></div>
        <div class="center">
          <h3 id="vTitle" class="mb1"></h3>
          <div class="meta">
            <span><i data-lucide="user"></i><span id="vTeacher"></span></span>
            <span><i data-lucide="book"></i><span id="vSubject"></span></span>
          </div>
          <button class="btn btn-outline" onclick="go('classes')"><i data-lucide="arrow-right"></i> العودة للفصول</button>
        </div>
      </div>
    </section>

    <!-- Dashboard (lightweight) -->
    <section id="dash" class="page">
      <div class="title"><i data-lucide="settings-2"></i><h3>لوحة التحكم</h3></div>
      <div class="grid">
        <div class="card">
          <label class="muted">هدفي:</label>
          <input id="goal" placeholder="مثلاً: كلية الطب" style="width:100%;padding:.7rem;border:1px solid var(--border);border-radius:10px;background:var(--bg2);color:var(--text)">
        </div>
        <div class="card">
          <label class="muted">المعدل المستهدف:</label>
          <input id="grade" placeholder="مثلاً: 99.5%" style="width:100%;padding:.7rem;border:1px solid var(--border);border-radius:10px;background:var(--bg2);color:var(--text)">
        </div>
      </div>
      <div class="center mb2"><button class="btn" id="saveDash"><i data-lucide="save"></i> حفظ</button></div>
    </section>
  </main>

  <!-- Continue toast -->
  <div id="toast" class="toast">
    <i data-lucide="play"></i>
    <div style="flex:1">
      <strong>متابعة آخر محاضرة</strong>
      <div class="muted" id="toastX"></div>
    </div>
    <button class="btn btn-outline" onclick="resumeLast()">متابعة</button>
    <button class="btn-icon" onclick="hideToast()"><i data-lucide="x"></i></button>
  </div>

<script>
/* ========= Theme ========= */
const themeBtn = document.getElementById("themeBtn");
(function initTheme(){
  const saved = localStorage.getItem("theme") || (matchMedia('(prefers-color-scheme:dark)').matches?'dark':'light');
  document.documentElement.setAttribute('data-theme', saved);
  themeBtn.querySelector('i').setAttribute('data-lucide', saved==='dark'?'sun':'moon');
})();
themeBtn.onclick = () => {
  const cur = document.documentElement.getAttribute('data-theme');
  const next = cur==='dark'?'light':'dark';
  document.documentElement.setAttribute('data-theme', next);
  localStorage.setItem('theme', next);
  themeBtn.querySelector('i').setAttribute('data-lucide', next==='dark'?'sun':'moon');
  lucide.createIcons();
};

/* ========= Nav ========= */
const pages = {home:byId('home'), category:byId('category'), classes:byId('classes'), video:byId('video'), dash:byId('dash')};
function go(k){ Object.values(pages).forEach(p=>p.classList.remove('active')); pages[k].classList.add('active'); window.scrollTo({top:0}); lucide.createIcons(); }
byId('dashBtn').onclick = ()=>{loadDash(); go('dash')};
function byId(id){return document.getElementById(id);}

/* ========= Data ========= */
const catMeta={
  "year-2026":{title:"الصفوف الدراسية 2026",endpoint:"https://adson1.netlify.app/data2.json"},
  "year-2025":{title:"الصفوف الدراسية 2025",endpoint:"https://adson1.netlify.app/data.json"},
  "distinguished":{title:"قسم المتميزين",endpoint:"https://adson1.netlify.app/ff.json"},
  "literary":{title:"القسم الأدبي",endpoint:"https://adson1.netlify.app/mm.json"}
};
let teachers=[], currentTeacher=null;
let lectureProgress = JSON.parse(localStorage.getItem("lectureProgress")||"{}");
let completed = JSON.parse(localStorage.getItem("completedLectures")||"{}");
let favs = JSON.parse(localStorage.getItem("favoriteTeachers")||"[]");
let last = JSON.parse(localStorage.getItem("lastWatched")||"null");

/* ========= Search ========= */
const q = byId('q'); byId('searchBtn').onclick = doSearch; q.addEventListener('input', debounce(doSearch,200));
function doSearch(){
  const term=(q.value||'').toLowerCase().trim();
  const list = term? teachers.filter(t=>t.name.toLowerCase().includes(term)||t.subject.toLowerCase().includes(term)): teachers;
  renderTeachers(list);
}

/* ========= Load Category ========= */
function loadCat(id){
  const meta = catMeta[id]; if(!meta) return;
  byId('catTitle').textContent = meta.title;
  go('category');
  byId('tGrid').innerHTML = skeletonCards(6);
  fetch(meta.endpoint,{cache:'no-store'})
    .then(r=>r.json())
    .then(d=>{ teachers=d.teachers||[]; renderTeachers(teachers); })
    .catch(()=>{ byId('tGrid').innerHTML='<div class="card center">تعذر تحميل البيانات</div>'; });
}

/* ========= Render ========= */
function renderTeachers(list){
  // favorites section
  const favData = list.filter(t=>favs.includes(t.id));
  const rest = list.filter(t=>!favs.includes(t.id));
  const favWrap = byId('favWrap');
  if(favData.length){ favWrap.classList.remove('hidden'); fillGrid(byId('favGrid'), favData); }
  else { favWrap.classList.add('hidden'); byId('favGrid').innerHTML=''; }
  fillGrid(byId('tGrid'), rest);
  lucide.createIcons();
}
function fillGrid(container, list){
  container.innerHTML='';
  list.forEach(t=>{
    const card = document.createElement('div');
    card.className='card teacher-card';
    card.innerHTML = `
      <div class="row-s">
        <div style="text-align:right">
          <img class="t-img" src="${t.image}" onerror="this.src='https://placehold.co/110x110?text=No+Img'">
          <div><strong>${t.name}</strong></div>
          <div class="muted">${t.subject||''}</div>
        </div>
        <button class="fav ${favs.includes(t.id)?'active':''}" title="مفضلة" onclick="event.stopPropagation();toggleFav(${t.id})">
          <i data-lucide="heart"></i>
        </button>
      </div>`;
    card.onclick=()=>showTeacher(t.id);
    container.appendChild(card);
  });
}
function toggleFav(id){
  const i=favs.indexOf(id); if(i>-1) favs.splice(i,1); else favs.push(id);
  localStorage.setItem("favoriteTeachers",JSON.stringify(favs));
  renderTeachers(teachers);
}
function showTeacher(id){
  currentTeacher = teachers.find(x=>x.id==id); if(!currentTeacher) return;
  byId('tHead').textContent = `${currentTeacher.name} • ${currentTeacher.subject||''}`;
  renderClasses(currentTeacher.classes||[]);
  go('classes');
}
function renderClasses(cls){
  const root = byId('clsList'); root.innerHTML='';
  cls.forEach((c,ci)=>{
    const card = document.createElement('div'); card.className='card';
    const done = (c.lectures||[]).filter(l=>completed[l.url]).length;
    const total = (c.lectures||[]).length;
    const head = document.createElement('div');
    head.className='row-s'; head.innerHTML=`<strong>${c.name}</strong><span class="muted">المكتمل: ${done}/${total}</span>`;
    const list = document.createElement('div'); list.className='list';
    (c.lectures||[]).forEach((lec,li)=>{
      const it = document.createElement('div'); it.className='item';
      it.innerHTML = `
        <div class="play" onclick="play(${ci},${li},'${lec.url}','${escapeStr(lec.title)}','${escapeStr(lec.description||'')}')">
          <i data-lucide="play-circle"></i><span>${li+1}. ${lec.title}</span>
        </div>
        <label class="row-s" style="gap:.4rem">
          <input type="checkbox" ${completed[lec.url]?'checked':''} onchange="markDone('${lec.url}',this)">
          <span class="muted">تم</span>
        </label>`;
      list.appendChild(it);
    });
    card.appendChild(head); card.appendChild(list); root.appendChild(card);
  });
  lucide.createIcons();
}

/* ========= Player ========= */
let plyr=null, hls=null, curURL='';
function play(ci,li,url,title,desc){
  curURL=url;
  const p = document.getElementById('player');
  if(plyr){ try{ plyr.destroy(); }catch(_){} }
  if(hls){ try{ hls.destroy(); }catch(_){} }
  plyr = new Plyr(p,{controls:["play","progress","current-time","mute","volume","settings","fullscreen"],speed:{selected:1,options:[0.75,1,1.25,1.5,2]}});
  const isHls = url.endsWith('.m3u8');
  if(isHls && Hls.isSupported()){
    hls = new Hls(); hls.attachMedia(p); hls.loadSource(url);
  }else{
    p.src = url; p.type = isHls? "application/x-mpegURL":"video/mp4";
  }
  // save last watched
  const tName = (currentTeacher&&currentTeacher.name)||'';
  const tId   = (currentTeacher&&currentTeacher.id)||null;
  localStorage.setItem('lastWatched',JSON.stringify({teacherId:tId,teacherName:tName,classIndex:ci,lectureIndex:li,lectureTitle:title,lectureUrl:url,lectureDescription:desc}));
  last = JSON.parse(localStorage.getItem('lastWatched'));
  updateToast();
  // progress saver
  plyr.on('timeupdate',()=>{
    if(plyr.duration>0){
      lectureProgress[url] = (plyr.currentTime/plyr.duration)*100;
      localStorage.setItem('lectureProgress',JSON.stringify(lectureProgress));
    }
  });
  // UI
  byId('vTitle').textContent = title;
  byId('vTeacher').textContent = tName;
  byId('vSubject').textContent = (currentTeacher&&currentTeacher.subject)||'';
  go('video');
}
function markDone(url,el){
  completed[url]=el.checked; localStorage.setItem('completedLectures',JSON.stringify(completed));
  // refresh counts
  renderClasses(currentTeacher.classes||[]);
}

/* ========= Toast ========= */
function updateToast(){
  if(!last) return;
  byId('toastX').textContent = `${last.teacherName||''} — ${last.lectureTitle||''}`;
  byId('toast').classList.add('show'); lucide.createIcons();
}
function hideToast(){ byId('toast').classList.remove('show'); }
function resumeLast(){
  if(!last) return; hideToast();
  // try to jump to that lecture; we need teacher from categories (light attempt)
  const metaList=Object.values(catMeta);
  (async ()=>{
    for(const m of metaList){
      try{
        const d = await (await fetch(m.endpoint,{cache:'no-store'})).json();
        const t = (d.teachers||[]).find(x=>x.id===last.teacherId);
        if(t){ currentTeacher=t; play(last.classIndex,last.lectureIndex,last.lectureUrl,last.lectureTitle,last.lectureDescription); break; }
      }catch(_){}
    }
  })();
}

/* ========= Dashboard ========= */
const saveDash = byId('saveDash');
function loadDash(){
  const p = JSON.parse(localStorage.getItem('userProfile')||"{}");
  byId('goal').value = p.goal||'';
  byId('grade').value = p.grade||'';
}
saveDash.onclick = ()=>{
  const p = {goal:byId('goal').value, grade:byId('grade').value};
  localStorage.setItem('userProfile',JSON.stringify(p));
  saveDash.innerHTML = '<i data-lucide="check"></i> تم الحفظ';
  lucide.createIcons();
  setTimeout(()=>{saveDash.innerHTML='<i data-lucide="save"></i> حفظ'; lucide.createIcons();},1500);
};

/* ========= Utils ========= */
function skeletonCards(n){return Array.from({length:n}).map(()=>`<div class="card"><div class="muted">جاري التحميل…</div></div>`).join('')}
function debounce(fn,ms){let t;return (...a)=>{clearTimeout(t);t=setTimeout(()=>fn(...a),ms)}}
function escapeStr(s){return String(s||'').replace(/["'`]/g,'')}

window.addEventListener('load',()=>{
  lucide.createIcons();
  if(last) updateToast();
});
</script>
</body>
</html>
"""
open('/mnt/data/edison_slim.html','w').write(content)
print("Saved to /mnt/data/edison_slim.html")
